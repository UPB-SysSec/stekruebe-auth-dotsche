server { # Site A
    listen       443 ssl;
    listen  [::]:443 ssl;

    server_name  siteA.site.org;
    
    # ssl setup
    ssl_certificate /keys/subdomainA.crt;
    ssl_certificate_key /keys/siteA.key;

    # client certificate
    ssl_client_certificate /keys/user_ca_a.crt;
    ssl_verify_client on; #'on' or 'optional'

    location / {
        if ($ssl_client_verify != SUCCESS) {
            return 403;
        }

        root /data/www/siteA;
        index  index.html;
    }
    
    access_log  /var/log/nginx/host.access.log  main;
}

server { # Site B
    listen       443 ssl;
    listen  [::]:443 ssl;

    server_name  siteB.site.org;

    # ssl setup
    ssl_certificate /keys/subdomainB.crt;
    ssl_certificate_key /keys/siteB.key;

    # client certificate
    ssl_client_certificate /keys/user_ca_b.crt;
    ssl_verify_client on; #'on' or 'optional'

    location / {
        if ($ssl_client_verify != SUCCESS) {
            return 403;
        }

        root /data/www/siteB;
        index  index.html;
    }
    
    access_log  /var/log/nginx/host.access.log  main;
}

# Default return 404 for everything else
server {
    listen      443 default_server;
    listen [::]:443 default_server;

    ssl_certificate /keys/subdomainC.crt;
    ssl_certificate_key /keys/siteC.key;
    
    server_name sitec.site.org;

 location / {
     root /data/www/siteC;
     index index.html;
 }
}